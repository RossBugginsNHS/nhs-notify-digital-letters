name: "Build Docs"
description: "build jekyll docs"
inputs:
      version:
        description: "Version of the software, set by the CI/CD pipeline workflow"
        required: true
        type: string
      is_version_prerelease:
        description: "Is this a semantically versioned pre release, set by the CI/CD pipeline workflow"
        required: true
        type: string

runs:
  using: "composite"
  steps:
    - name: "Checkout code"
      uses: actions/checkout@v5

    - name: "Get artifacts: jekyll docs"
      uses: actions/download-artifact@v5
      with:
        path: ./artifacts/jekyll-docs-${{ inputs.version }}
        name: jekyll-docs-${{ inputs.version }}

    - name: "Get artifacts: schema"
      uses: actions/download-artifact@v5
      with:
        path: ./artifacts/schemas-${{ inputs.version }}
        name: schemas-${{ inputs.version }}


    - name: Draft Release
      env:
        GH_TOKEN: ${{ github.token }}
        GH_REPO: ${{ github.repository }}
      run: |
        gh release create \
        "${{ inputs.version }}" \
        --draft \
        --latest \
        --title "${{ inputs.version }}" \
        --notes "Release of ${{ inputs.version }}" \
        ${{ inputs.is_version_prerelease == 'true' && '--prerelease' || '' }}

    - name: "Upload jeykll docs release asset"
      env:
        GH_TOKEN: ${{ github.token }}
        GH_REPO: ${{ github.repository }}
      run: |
        cp ./artifacts/jekyll-docs-${{ inputs.version }}/artifact.tar $RUNNER_TEMP/jekyll-docs-${{ inputs.version }}.tar
        gh release upload \
        "${{ inputs.version }}" \
        $RUNNER_TEMP/jekyll-docs-${{ inputs.version }}.tar#jekyll-docs-${{ inputs.version }}

    - name: "Upload schema release asset"
      env:
        GH_TOKEN: ${{ github.token }}
        GH_REPO: ${{ github.repository }}
      run: |
        cp ./artifacts/schemas-${{ inputs.version }}/artifact.tar $RUNNER_TEMP/schemas-${{ inputs.version }}.tar
        gh release upload \
        "${{ inputs.version }}" \
        $RUNNER_TEMP/schemas-${{ inputs.version }}.tar#schemas-${{ inputs.version }}


    - name: Publish Release
      env:
        GH_TOKEN: ${{ github.token }}
        GH_REPO: ${{ github.repository }}
      run: gh release edit "${{ inputs.version }}" --draft=false
